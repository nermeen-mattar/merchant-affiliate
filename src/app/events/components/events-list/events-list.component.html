<div class="app-events">
  <div *ngIf="isPastEvents" class="app-events__back" (click)="updateEvents(false)">
    <mat-icon color="primary">chevron_left</mat-icon>
    {{'BACK'| translate}}
  </div>
  <div class="app-events__header">
    <h3 class="app-events__header__title">
      <span class="app-events__header__title__text">{{ (isPastEvents ? 'EVENT.PAST_EVENTS' : 'EVENT.EVENTS') | translate}}</span>
      <mat-icon *ngIf="!isPastEvents" class="app-events__action" (click)="updateEvents(true)" color="primary">history</mat-icon>
      <button mat-mini-fab *ngIf="displayAdminActions" color="primary" class="app-events__action app-events__add" routerLink="new">
        + </button>
    </h3>
    <div class="app-events__header__team-selector">
      <mat-form-field>
        <mat-select [(value)]="selectedTeam" (change)="changeSelectedTeam()">
          <mat-option *ngFor="let team of userTeams" [value]="team">
            {{ team.teamName }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
  <!-- <mat-form-field class="app-events__filter">
    <input matInput (keyup)="applyFilter($event.target.value)" [(ngModel)]="filterString" placeholder="{{'SEARCH_PLACEHOLDER' | translate}}">
  </mat-form-field> -->
  <!-- <mat-icon *ngIf="displayAdminActions" class="app-events__action" routerLink="new" color="primary">add</mat-icon> -->
  <div class="app-events__container">
    <mat-table class="app-events__container__table" [dataSource]="eventsDataSource" matSort>
      <ng-container matColumnDef="id">
        <mat-header-cell class="app-events__container__table__header-cell" *matHeaderCellDef mat-sort-header> {{'EVENT.OUT' | translate}}
          <mat-slide-toggle color="primary" disabled> </mat-slide-toggle> {{'EVENT.IN' | translate}}
        </mat-header-cell>
        <mat-cell class="app-events__container__table__content-cell" *matCellDef="let row">
          <mat-slide-toggle color="primary" (change)="toogleParticipationInEvent($event.checked, row.id)" [disabled]="isPastEvents"
            [checked]="row.myParticipation && row.myParticipation.action !== 'cancel'">
          </mat-slide-toggle>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="date">
        <mat-header-cell class="app-events__container__table__header-cell" *matHeaderCellDef mat-sort-header>
          {{'EVENT.DATE' | translate}} </mat-header-cell>
        <mat-cell class="app-events__container__table__content-cell" *matCellDef="let row"> {{row.date}} </mat-cell>
      </ng-container>
      <ng-container matColumnDef="time">
        <mat-header-cell class="app-events__container__table__header-cell" *matHeaderCellDef mat-sort-header> {{'EVENT.TIME' | translate}} </mat-header-cell>
        <mat-cell class="app-events__container__table__content-cell" *matCellDef="let row"> {{row.startTime | stringNormalizer:timeFormat}} - {{row.endTime | stringNormalizer:timeFormat }} </mat-cell>
      </ng-container>
      <ng-container matColumnDef="event">
        <mat-header-cell class="app-events__container__table__header-cell" *matHeaderCellDef mat-sort-header> {{'EVENT.EVENT' | translate}}
        </mat-header-cell>
        <mat-cell class="app-events__container__table__content-cell" *matCellDef="let row"> {{row.eventName}} </mat-cell>
      </ng-container>
      <ng-container matColumnDef="status">
        <mat-header-cell class="app-events__container__table__header-cell" *matHeaderCellDef mat-sort-header> {{'EVENT.STATUS' | translate}} </mat-header-cell>
        <mat-cell  style="min-width: 178px !important;" class="app-events__container__table__content-cell" *matCellDef="let row">
          <!-- <span *ngIf="row.detailedParticipations">{{row.numOfParticipations}} / {{row.detailedParticipations.length}}</span> -->
          <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members">
            <div>
                <div style="width: 24px; display:inline-block;"></div>
              <div *ngIf="row.minCriticalValue" class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__min">
              Min </div>
              <!-- {{'EVENT.MIN_PER_EVENT' | translate}} -->
              <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__seperator"></div>
              <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__actual">Actual</div>
              <!--  {{'EVENT.MAX_PER_EVENT' | translate}} -->

              <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__seperator"> </div>
              <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__max">Max</div>
              <!--  {{'EVENT.MAX_PER_EVENT' | translate}} -->
            </div>
            <div style="display:flex; align-items:center;">
                <mat-icon style="margin-bottom:2  px; color:red;"  *ngIf="(row.minCriticalValue && row.minCriticalValue > row.numOfParticipations) || (row.maxCriticalValue && row.maxCriticalValue < row.numOfParticipations); else success">error</mat-icon>
                <div>
                    <ng-template #success>
                      <mat-icon style="margin-bottom:2  px; color:green;"  >check_circle</mat-icon>
                    </ng-template>
                    <div *ngIf="row.minCriticalValue" class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__min">[ {{row.minCriticalValue}}</div>
                    <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__seperator"> {{row.minCriticalValue ? "-" : "("}}</div>

                    <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__actual"> {{row.numOfParticipations}} </div>
                    <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__seperator"> {{row.maxCriticalValue ? "-" : ")"}}
                        </div>
                        <div *ngIf="row.maxCriticalValue" class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__max">
                        {{row.maxCriticalValue}} ]</div>
                    </div>
            </div>

            </div>
        </mat-cell>
      </ng-container>
      <!-- <ng-container matColumnDef="minCriticalValue">
        <mat-header-cell class="app-events__container__table__header-cell" *matHeaderCellDef mat-sort-header> {{'EVENT.MIN_PER_EVENT' | translate}} </mat-header-cell>
        <mat-cell class="app-events__container__table__content-cell" *matCellDef="let row"> {{row.minCriticalValue}} </mat-cell>
      </ng-container>
      <ng-container matColumnDef="maxCriticalValue">
        <mat-header-cell class="app-events__container__table__header-cell" *matHeaderCellDef mat-sort-header> {{'EVENT.MAX_PER_EVENT' | translate}} </mat-header-cell>
        <mat-cell class="app-events__container__table__content-cell" *matCellDef="let row"> {{row.maxCriticalValue}} </mat-cell>
      </ng-container> -->
      <ng-container matColumnDef="actions">
        <mat-header-cell class="app-events__container__table__header-cell" *matHeaderCellDef mat-sort-header> </mat-header-cell>
        <mat-cell class="app-events__container__table__content-cell" *matCellDef="let row">
          <ng-container *ngIf="displayAdminActions">
            <mat-icon class="app-events__action" [routerLink]="row.id" color="primary">edit</mat-icon>
            <mat-icon class="app-events__action" (click)="deleteEvent($event, row.id)" color="primary">delete</mat-icon>
          </ng-container>
          <mat-icon class="app-events__action" routerLink="details/{{row.id}}" color="primary">ellipsis-h</mat-icon>
        </mat-cell>
      </ng-container>
      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;">
      </mat-row>
    </mat-table>


    <mat-accordion class="app-events__container__accordion">
      <mat-expansion-panel *ngFor="let event of eventsDataSource?.data" class="app-events__container__accordion__expandable-item">
        <mat-expansion-panel-header>
          <mat-panel-title lass="app-events__container__accordion__expandable-item__title">
            <mat-slide-toggle color="primary" (change)="toogleParticipationInEvent($event.checked, event.id)" (click)="preventTriggeringAccordion($event)"
              [disabled]="isPastEvents" [checked]="event.myParticipation && event.myParticipation.action !== 'cancel'">
            </mat-slide-toggle>
            <span style="margin: 0rem 1rem;">{{event.date}}</span>
            <span> {{event.eventName}} </span>
            <!-- {{'EVENT.TIME' | translate}}:  -->
          </mat-panel-title>
          <mat-panel-description>
            <!-- {{'EVENT.STATUS' | translate}}: -->
            <!-- <mat-icon>insert_chart</mat-icon> -->
            <!-- {{event.numOfParticipations}} / {{event.detailedParticipations.length}} -->
          </mat-panel-description>
        </mat-expansion-panel-header>
        <mat-card-content>
          <div class="app-events__container__accordion__expandable-item__expanded-content">
            <div>
              <mat-icon color="primary">alarm</mat-icon>
              <mat-icon color="primary">check_circle</mat-icon>
              <mat-icon color="primary">error</mat-icon>

              {{event.startTime | stringNormalizer:timeFormat }} - {{event.endTime | stringNormalizer:timeFormat }}</div>
            <div style="margin: 0rem 1rem;" class="app-events__container__accordion__expandable-item__expanded-content__number-of-members">
              <div>
                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__min"> Min </div>
                <!-- {{'EVENT.MIN_PER_EVENT' | translate}} -->
                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__seperator"> - </div>
                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__actual">Actual</div>
                <!--  {{'EVENT.MAX_PER_EVENT' | translate}} -->

                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__seperator"> - </div>
                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__max">Max</div>
                <!--  {{'EVENT.MAX_PER_EVENT' | translate}} -->
              </div>
              <div>
                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__min">{{event.minCriticalValue}}</div>
                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__seperator"> - </div>

                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__actual"> {{event.numOfParticipations}} </div>
                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__seperator"> - </div>
                <div class="app-events__container__accordion__expandable-item__expanded-content__number-of-members__max"> {{event.maxCriticalValue}}</div>
              </div>
            </div>

          </div>

          <mat-divider></mat-divider>
          <button (click)="deleteEvent($event, event.id)" mat-raised-button color="primary" class="app-events__container__accordion__expandable-item__button">{{ 'DELETE' | translate }}</button>
          <button [routerLink]="event.id" mat-raised-button color="primary" class="app-events__container__accordion__expandable-item__button">{{ 'EDIT' | translate }}</button>

          <!-- <button mat-menu-item (click)="deleteEvent($event, activeEvent.id)">
                <mat-icon>delete</mat-icon>
                <span>Delete</span>
              </button>
              <button mat-menu-item [routerLink]="activeEvent.id">
                <mat-icon>create</mat-icon>
                <span>Edit</span>
              </button> -->

        </mat-card-content>
      </mat-expansion-panel>
    </mat-accordion>

    <mat-spinner class="app-events__container__spinner" *ngIf="!eventsDataSource"></mat-spinner>
    </div>
  </div>

  <mat-menu #menu="matMenu">
    <ng-container *ngIf="activeEvent">
      <button mat-menu-item (click)="deleteEvent($event, activeEvent.id)">
        <mat-icon>delete</mat-icon>
        <span>Delete</span>
      </button>
      <button mat-menu-item [routerLink]="activeEvent.id">
        <mat-icon>create</mat-icon>
        <span>Edit</span>
      </button>
    </ng-container>
  </mat-menu>












  <!-- start of mob-->
  <div *ngIf="test" class="app-events__container__cards-list">
    <mat-card class="app-events__container__cards-list__item" *ngFor="let event of eventsDataSource?.data">
      <mat-card-header>
        <div mat-card-avatar>
          <i>event</i>
        </div>
        <mat-card-title routerLink="details/{{event.id}}">{{event.eventName}}</mat-card-title>
        <mat-card-subtitle>{{event.date}}</mat-card-subtitle>
        <button class="app-events__container__cards-list__item__more-btn" mat-icon-button [matMenuTriggerFor]="menu" (click)="setActiveEvent(event)"
          *ngIf="displayAdminActions">
          <mat-icon>more_vert</mat-icon>
        </button>
      </mat-card-header>
      <!-- <img mat-card-image src="https://material.angular.io/assets/img/examples/shiba2.jpg" alt="Photo of a Shiba Inu"> -->
      <mat-card-content>
        <mat-list class="app-events__container__cards-list__item__content">
          <mat-list-item class="app-events__container__cards-list__item__content__item">
            <mat-icon>alarm</mat-icon>
            <div>
              {{'EVENT.TIME' | translate}}: {{event.startTime | stringNormalizer:timeFormat}} - {{event.endTime | stringNormalizer:timeFormat}}
            </div>
          </mat-list-item>
          <mat-list-item class="app-events__container__cards-list__item__content__item">
            <mat-icon>insert_chart</mat-icon>
            <div class="content">
              {{'EVENT.STATUS' | translate}}: {{event.numOfParticipations}} / {{event.detailedParticipations.length}}
            </div>
          </mat-list-item>
          <mat-list-item class="app-events__container__cards-list__item__content__item">
            <mat-icon>warning</mat-icon>
            <div class="content">
              {{'EVENT.MIN_PER_EVENT' | translate}}: {{event.minCriticalValue}}
            </div>
          </mat-list-item>
          <mat-list-item class="app-events__container__cards-list__item__content__item">
            <mat-icon>warning</mat-icon>
            <div class="content">
              {{'EVENT.MAX_PER_EVENT' | translate}}: {{event.maxCriticalValue}}
            </div>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
      <mat-card-actions>
        <button mat-raised-button routerLink="details/{{event.id}}">
          <span>Info</span>
        </button>
        <button mat-raised-button (click)="toogleParticipationInEvent(true, event.id)" color="primary" *ngIf="!event.myParticipation || event.myParticipation.action === 'cancel'"
          [disabled]="isPastEvents">
          {{'GOING' | translate}}
        </button>
        <button mat-raised-button color="primary" (click)="toogleParticipationInEvent(false, event.id)" *ngIf="event.myParticipation && event.myParticipation.action !== 'cancel'"
          [disabled]="isPastEvents">
          {{'NOT_GOING' | translate}}
        </button>

      </mat-card-actions>
    </mat-card>
  </div>
  <!-- end of mob-->
